# TensorRT Engine Build Configuration
# Use with: python scripts/build_engine.py --config configs/tensorrt_config.yaml

# =============================================================================
# Model Settings
# =============================================================================
model:
  onnx_path: "models/resnet50.onnx"
  output_path: "engines/resnet50_int8.engine"

# =============================================================================
# Builder Settings
# =============================================================================
builder:
  # Precision: fp32, fp16, int8
  precision: "int8"
  
  # Maximum batch size
  max_batch_size: 64
  
  # GPU workspace size (GB)
  workspace_size_gb: 4
  
  # Optimization level (0-5, higher = slower build, faster inference)
  optimization_level: 5
  
  # Enable sparse weights (Ampere+ GPUs)
  enable_sparse: false
  
  # Use timing cache for faster rebuilds
  enable_timing_cache: true
  timing_cache_path: "cache/timing.cache"

# =============================================================================
# Dynamic Shapes (for variable input sizes)
# =============================================================================
dynamic_shapes:
  input:
    min: [1, 3, 224, 224]
    opt: [16, 3, 224, 224]
    max: [64, 3, 224, 224]

# =============================================================================
# INT8 Calibration
# =============================================================================
calibration:
  # Algorithm: entropy, entropy_2, minmax
  algorithm: "entropy_2"
  
  # Calibration cache file
  cache_file: "cache/calibration.cache"
  
  # Number of calibration batches
  num_batches: 500
  
  # Calibration data directory
  data_dir: "data/calibration"
  
  # Calibration batch size
  batch_size: 8

# =============================================================================
# Layer Precision Overrides
# =============================================================================
# Specify precision for specific layers (useful for maintaining accuracy)
layer_precision:
  # Keep first and last layers in higher precision
  - pattern: "Conv_0"
    precision: "fp16"
  - pattern: "MatMul_*"
    precision: "fp16"
  - pattern: "Softmax*"
    precision: "fp32"

# =============================================================================
# Optimization Flags
# =============================================================================
optimization:
  # Enable kernel timing for autotuning
  enable_timing: true
  
  # Prefer precision over speed
  prefer_precision: false
  
  # Strict type constraints
  strict_types: false
  
  # Layer device placement (for multi-GPU)
  device_type: "GPU"

# =============================================================================
# Output Settings
# =============================================================================
output:
  # Save engine metadata
  save_metadata: true
  metadata_path: "engines/resnet50_int8_metadata.json"
  
  # Verify engine after build
  verify: true
  verification_tolerance: 0.01

# =============================================================================
# Profiles (for A/B testing different configurations)
# =============================================================================
profiles:
  # High-throughput profile
  throughput:
    precision: "int8"
    max_batch_size: 128
    optimization_level: 5
  
  # Low-latency profile
  latency:
    precision: "fp16"
    max_batch_size: 1
    optimization_level: 3
  
  # Balanced profile
  balanced:
    precision: "fp16"
    max_batch_size: 32
    optimization_level: 4
